{% extends "booking/base.html" %}
{% block title %}Bookings - Scout Scheduler{% endblock %}
{% block page_title %}Bookings{% endblock %}
{% block page_subtitle %}Manage appointments at a glance{% endblock %}

{% block header_actions %}
  <a href="{% url 'booking:book' %}" class="btn btn-groom btn-lg">
    <i class="bi bi-scissors me-1"></i>Create new booking
  </a>
{% endblock %}

{% block content %}
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Customer</th>
              <th>Phone</th>
              <th>Pet</th>
              <th>Date</th>
              <th>Time</th>
              <th>Groomer</th>
              <th>API Ref</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
          {% for b in page_obj.object_list %}
            <tr>
              <td class="fw-semibold">
                <i class="bi bi-person me-1"></i>
                {{ b.customer.first_name }} {{ b.customer.last_name }}
              </td>
              <td>
                {% if b.customer.phone %}
                  <a href="tel:{{ b.customer.phone }}">{{ b.customer.phone }}</a>
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td><span class="badge rounded-pill text-bg-soft">{{ b.pet_name }}</span></td>
              <td>{{ b.appointment_date|date:"M j, Y" }}</td>
              <td>{{ b.appointment_time|time:"g:i A" }}</td>
              <td><i class="bi bi-stars me-1"></i>{{ b.groomer_name }}</td>
              <td class="text-muted">{{ b.api_ref }}</td>
              <td class="text-end">
                <div class="btn-group">
                  <a class="btn btn-outline-primary btn-sm" href="{% url 'booking:detail' b.id %}" title="View">
                    <i class="bi bi-eye"></i>
                  </a>
                  <button class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#cancelModal-{{ b.id }}" title="Cancel">
                    <i class="bi bi-x-circle"></i>
                  </button>
                </div>

                <!-- Cancel confirm modal (POST) -->
                <div class="modal fade" id="cancelModal-{{ b.id }}" tabindex="-1" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title"><i class="bi bi-exclamation-triangle me-2"></i>Cancel booking?</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                      </div>
                      <div class="modal-body">
                        Cancel {{ b.customer.first_name }} {{ b.customer.last_name }}’s appointment
                        for {{ b.pet_name }} on <strong>{{ b.appointment_date|date:"M j" }}</strong>
                        at <strong>{{ b.appointment_time|time:"g:i A" }}</strong> with {{ b.groomer_name }}?
                      </div>
                      <div class="modal-footer">
                        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Keep</button>
                        <form action="{% url 'booking:cancel' b.id %}" method="post" class="d-inline">
                          {% csrf_token %}
                          <input type="hidden" name="next" value="{{ request.get_full_path }}">
                          <button type="submit" class="btn btn-danger">Yes, cancel</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="8" class="text-center py-5 text-muted">
                <i class="bi bi-calendar2-x fs-4 d-block mb-2"></i>
                No bookings yet. <a href="{% url 'booking:book' %}">Create the first one</a>.
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  {% if page_obj.has_other_pages %}
  <nav class="mt-3">
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
      {% endif %}
      <li class="page-item active"><span class="page-link">{{ page_obj.number }}</span></li>
      {% if page_obj.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
{% endblock %}
